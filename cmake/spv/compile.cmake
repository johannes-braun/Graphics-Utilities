get_filename_component(SPVGEN_CURRENT_BINARY_DIR ${SPVGEN_HEADER} DIRECTORY)
if(NOT EXISTS ${SPVGEN_CURRENT_BINARY_DIR})
	file(MAKE_DIRECTORY ${SPVGEN_CURRENT_BINARY_DIR})
endif()
get_filename_component(SPVGEN_INPUT_NAME ${SPVGEN_INPUT} NAME)

if(SPVGEN_INCLUDES)
	set(SPVGEN_INCLUDES "-I${SPVGEN_INCLUDES}")
endif()
if(SPVGEN_DEFINITIONS)
	set(SPVGEN_DEFINITIONS "-D${SPVGEN_DEFINITIONS}")
endif()
message(${SPVGEN_GLSLC_COMMAND}  ${SPVGEN_INCLUDES}  ${SPVGEN_DEFINITIONS}  ${SPVGEN_ARGS}   -mfmt=c "${SPVGEN_INPUT}" -o "${SPVGEN_CURRENT_BINARY_DIR}/gen-${SPVGEN_INPUT_NAME}")

execute_process(COMMAND ${SPVGEN_GLSLC_COMMAND}  ${SPVGEN_INCLUDES}  ${SPVGEN_DEFINITIONS}  ${SPVGEN_ARGS}  -mfmt=c "${SPVGEN_INPUT}" -o "${SPVGEN_CURRENT_BINARY_DIR}/gen-${SPVGEN_INPUT_NAME}")
file(READ ${SPVGEN_CURRENT_BINARY_DIR}/gen-${SPVGEN_INPUT_NAME} SPVGEN_GENERATED_SPV)
configure_file(${SPVGEN_HEADER}.in ${SPVGEN_HEADER} @ONLY)
file(REMOVE ${SPVGEN_CURRENT_BINARY_DIR}/gen-${SPVGEN_INPUT_NAME})

message(${SPVGEN_ARGS})